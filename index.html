<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M≈©i T√™n Th√¥ng Minh</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; background: #eef6ff; margin: 0; padding: 20px; }
  h1 { color: #0074D9; }
  .screen { display: none; }
  .active { display: block; }
  .login-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.2); width: 340px; margin: 50px auto; }
  button { padding: 15px 25px; margin: 15px; border: none; border-radius: 10px; background: #0074D9; color: white; font-size: 18px; cursor: pointer; transition: 0.2s; }
  button:hover { background: #005fa3; transform: scale(1.05); }
  .question { margin: 20px auto; padding: 20px; background: white; border-radius: 12px; width: 90%; max-width: 600px; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
  .group { display: flex; justify-content: space-around; margin-top: 15px; flex-wrap: wrap; }
  .arrow-box { border: 2px dashed #ccc; width: 40%; padding: 10px; border-radius: 8px; min-height: 80px; }
  .arrow { font-size: 50px; cursor: grab; margin: 10px; display: inline-block; user-select: none; touch-action: none; }
  .arrow.up { color: green; }
  .arrow.down { color: red; }
  #timer { font-size: 22px; font-weight: bold; color: #ff4136; margin-top: 10px; }
  #result { font-size: 20px; font-weight: bold; color: #2ECC40; margin-top: 20px; }
  #scoreboard { margin-top: 30px; font-size: 18px; text-align: left; width: 90%; margin-left: auto; margin-right: auto; }
</style>
</head>
<body>

<h1>üéØ Tr√≤ ch∆°i M≈©i T√™n Th√¥ng Minh</h1>

<div id="login" class="screen active">
  <div class="login-box">
    <h2>Ch·ªçn nh√≥m ƒë·ªÉ b·∫Øt ƒë·∫ßu</h2>
    <button onclick="startGame(0)">Nh√≥m 1</button>
    <button onclick="startGame(1)">Nh√≥m 2</button>
  </div>
</div>

<div id="game" class="screen"></div>
<div id="timer"></div>
<div id="result"></div>
<div id="scoreboard"></div>

<audio id="sound-correct" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="sound-wrong" src="https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg"></audio>
<audio id="sound-timeout" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
const questions = [
  { title: "C√¢u 1: Chi ph√≠", answer: { no: "up", co: "down" }},
  { title: "C√¢u 2: Doanh thu", answer: { no: "down", co: "up" }}
];

let teams = [
  { name: "Nh√≥m 1", score: 0, results: [] },
  { name: "Nh√≥m 2", score: 0, results: [] }
];
let currentTeamIndex = 0;
let currentQuestion = 0;
let timer;
let timeLeft = 05;

function startGame(teamIndex) {
  currentTeamIndex = teamIndex;
  currentQuestion = 0;
  document.getElementById("login").classList.remove("active");
  document.getElementById("game").classList.add("active");
  showQuestion();
  startTimer();
}

function startTimer() {
  timeLeft = 05;
  document.getElementById("timer").textContent = "‚è∞ Th·ªùi gian: " + timeLeft + "s";
  clearInterval(timer);
  timer = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").textContent = "‚è∞ Th·ªùi gian: " + timeLeft + "s";
    if (timeLeft <= 0) {
      clearInterval(timer);
      playSound("timeout");
      checkAnswer(true);
    }
  }, 1000);
}

function showQuestion() {
  const q = questions[currentQuestion];
  const team = teams[currentTeamIndex];
  document.getElementById("result").textContent = "";
  const gameDiv = document.getElementById("game");
  gameDiv.innerHTML = `
    <div class="question">
      <h2>${q.title}</h2>
      <h3>Ng∆∞·ªùi ch∆°i: <span style="color:#0074D9">${team.name}</span></h3>
      <div class="group">
        <div class="arrow-box" id="no"><strong>N·ª£</strong></div>
        <div class="arrow-box" id="co"><strong>C√≥</strong></div>
      </div>
      <div style="margin-top:30px;">
        <span class="arrow up" id="up" draggable="true">‚Üë</span>
        <span class="arrow down" id="down" draggable="true">‚Üì</span>
      </div>
      <button onclick="checkAnswer()">N·ªôp b√†i</button>
    </div>
  `;

  enableDragAndTouch("up");
  enableDragAndTouch("down");
}

// --- H·ªó tr·ª£ k√©o th·∫£ chu·ªôt v√† c·∫£m ·ª©ng ---
function enableDragAndTouch(id) {
  const arrow = document.getElementById(id);
  let offsetX = 0, offsetY = 0;

  // === K√©o b·∫±ng chu·ªôt ===
  arrow.addEventListener("dragstart", (e) => {
    e.dataTransfer.setData("text/plain", id);
  });

  document.querySelectorAll(".arrow-box").forEach(box => {
    box.addEventListener("dragover", (e) => e.preventDefault());
    box.addEventListener("drop", (e) => {
      const draggedId = e.dataTransfer.getData("text/plain");
      const draggedArrow = document.getElementById(draggedId);
      box.appendChild(draggedArrow);
    });
  });

  // === K√©o b·∫±ng c·∫£m ·ª©ng ===
  arrow.addEventListener("touchstart", (e) => {
    const touch = e.touches[0];
    offsetX = touch.clientX - arrow.getBoundingClientRect().left;
    offsetY = touch.clientY - arrow.getBoundingClientRect().top;
    arrow.style.position = "absolute";
    arrow.style.zIndex = "1000";
  });

  arrow.addEventListener("touchmove", (e) => {
    e.preventDefault();
    const touch = e.touches[0];
    arrow.style.left = (touch.clientX - offsetX) + "px";
    arrow.style.top = (touch.clientY - offsetY) + "px";
  });

  arrow.addEventListener("touchend", (e) => {
    const touch = e.changedTouches[0];
    const x = touch.clientX;
    const y = touch.clientY;
    const elements = document.elementsFromPoint(x, y);
    const target = elements.find(el => el.classList.contains("arrow-box"));
    if (target) target.appendChild(arrow);
    arrow.style.position = "static";
    arrow.style.left = "";
    arrow.style.top = "";
    arrow.style.zIndex = "";
  });
}

function checkAnswer(timeout = false) {
  clearInterval(timer);
  const q = questions[currentQuestion];
  const team = teams[currentTeamIndex];
  const noArrow = document.getElementById("no").querySelector(".arrow");
  const coArrow = document.getElementById("co").querySelector(".arrow");
  const noVal = noArrow ? (noArrow.classList.contains("up") ? "up" : "down") : null;
  const coVal = coArrow ? (coArrow.classList.contains("up") ? "up" : "down") : null;

  let resultText = "";
  let correct = false;

  if (timeout) {
    resultText = "‚è∞ H·∫øt gi·ªù!";
  } else if (noVal === q.answer.no && coVal === q.answer.co) {
    resultText = "‚úÖ Ch√≠nh x√°c!";
    playSound("correct");
    team.score += 1;
    correct = true;
  } else {
    resultText = "‚ùå Sai r·ªìi!";
    playSound("wrong");
  }

  team.results.push({ question: q.title, no: noVal, co: coVal, correct: correct });
  document.getElementById("result").textContent = resultText;

  setTimeout(() => {
    currentQuestion++;
    if (currentQuestion < questions.length) {
      showQuestion();
      startTimer();
    } else {
      showResult();
    }
  }, 1500);
}

function playSound(type) {
  document.getElementById(`sound-${type}`).play();
}

function showResult() {
  document.getElementById("game").classList.remove("active");
  document.getElementById("timer").textContent = "";
  document.getElementById("result").textContent = "";

  const team = teams[currentTeamIndex];
  let html = `
    <div class="login-box">
      <h2>K·∫øt qu·∫£ nh√≥m: ${team.name}</h2>
      <p>ƒêi·ªÉm: <strong>${team.score}/${questions.length}</strong></p>
      <hr>
  `;

  team.results.forEach((r) => {
    html += `
      <p><strong>${r.question}</strong> (${r.correct ? "‚úÖ ƒê√∫ng" : "‚ùå Sai"})</p>
      <p>‚û°Ô∏è N·ª£: ${r.no ? (r.no === "up" ? "üü¢‚Üë" : "üî¥‚Üì") : "‚Äî"}</p>
      <p>‚û°Ô∏è C√≥: ${r.co ? (r.co === "up" ? "üü¢‚Üë" : "üî¥‚Üì") : "‚Äî"}</p>
      <hr>
    `;
  });

  html += `<button onclick="backToLogin()">Quay l·∫°i ch·ªçn nh√≥m</button></div>`;
  document.getElementById("scoreboard").innerHTML = html;
}

function backToLogin() {
  document.getElementById("scoreboard").innerHTML = "";
  document.getElementById("login").classList.add("active");
}
</script>
</body>
</html>
